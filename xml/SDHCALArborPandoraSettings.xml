<!-- Arbor Pandora settings xml file -->

<pandora>

    <!-- HELPER CLASS SETTINGS -->
    <IsMonitoringEnabled> false </IsMonitoringEnabled>
    <ShouldDisplayAlgorithmInfo> false </ShouldDisplayAlgorithmInfo>

    <!-- CaloHit helper settings -->
    <CaloHitHelper>
        <ShouldCalculateDensityWeight>true</ShouldCalculateDensityWeight>
        <ShouldCalculateSurroundingEnergy>true</ShouldCalculateSurroundingEnergy>
        
        <IsolationCaloHitMaxSeparation>60</IsolationCaloHitMaxSeparation>
        <IsolationNLayers>3</IsolationNLayers>
        <IsolationCutDistanceFine>25.0</IsolationCutDistanceFine>
        <IsolationCutDistanceCoarse>30.0</IsolationCutDistanceCoarse>
        <IsolationMaxNearbyHits>2</IsolationMaxNearbyHits>
    </CaloHitHelper>
    
    <HadronicEnergyCorrectionFunctions>
        SDHCALEnergyCorrection
    </HadronicEnergyCorrectionFunctions>

    <!-- ARBOR PANDORA ALGORITHM SETTINGS -->

    <!-- Select tracks and hits to use for clustering -->
    <algorithm type = "EventPreparation"/>
        
        
    <!-- 2D clusters formation -->
    <algorithm type = "ClusteringParent">
      <algorithm type = "IntraLayerClustering" description = "ClusterFormation">
        <IntraLayerMaxDistance> 15.0 </IntraLayerMaxDistance>
        <ShouldSplitClusterInSingleCaloHitClusters> true </ShouldSplitClusterInSingleCaloHitClusters>
        <MaximumSizeForClusterSplitting> 4 </MaximumSizeForClusterSplitting>
      </algorithm>   
      <ClusterListName> ConnectorClusteringInput </ClusterListName>
      <ReplaceCurrentClusterList>true</ReplaceCurrentClusterList>
    </algorithm>

    
    <!-- Arbor algorithm based on 2D clusters and calo mip tracks -->
    <algorithm type = "ClusteringParent">
      <algorithm type = "ArborConnectorClustering" description = "ClusterFormation">
          <InputClusterListName> ConnectorClusteringInput </InputClusterListName>
          <MaximumForwardDistanceForConnectionFine>      50.0  </MaximumForwardDistanceForConnectionFine>
          <MaximumForwardDistanceForConnectionCoarse> 85.0 </MaximumForwardDistanceForConnectionCoarse>
          <MaximumTransverseDistanceForConnectionFine>   21.0  </MaximumTransverseDistanceForConnectionFine>
          <MaximumTransverseDistanceForConnectionCoarse>   41.0  </MaximumTransverseDistanceForConnectionCoarse>
          <AllowForwardConnectionForIsolatedObjects>false</AllowForwardConnectionForIsolatedObjects>
          <ShouldUseIsolatedObjects>true</ShouldUseIsolatedObjects>
          <MaximumNumberOfKeptConnectors>            5     </MaximumNumberOfKeptConnectors>
          <OrderParameterAnglePower>                 5   </OrderParameterAnglePower>
          <OrderParameterDistancePower>              0.5   </OrderParameterDistancePower>
          <ShowConnectors> false </ShowConnectors>
      </algorithm>
      <algorithm type = "TopologicalAssociationParent" description = "ClusterAssociation">
        <associationAlgorithms>
          <algorithm type = "SmallClusterMerging" description = "TopologicalAssociation">
            <MinimumClusterSizeForMerging> 15 </MinimumClusterSizeForMerging>
            <LargeDistanceClusterCut> 1000 </LargeDistanceClusterCut>
            <ShouldUseCentroidForClusterDistance> false </ShouldUseCentroidForClusterDistance>
          </algorithm>
        </associationAlgorithms>
      </algorithm> 
      <ClusterListName> ArborClusters </ClusterListName>
      <ReplaceCurrentClusterList>true</ReplaceCurrentClusterList>
    </algorithm> 

    <!-- PFO Creation -->
    <algorithm type = "PfoCreation">
      <OutputPfoListName> ArborPFOs </OutputPfoListName>
      <ShouldCreateTrackBasedPfos> true </ShouldCreateTrackBasedPfos>
      <ShouldCreateNeutralPfos> true </ShouldCreateNeutralPfos>
      <MinClusterHadronicEnergy> 2.0 </MinClusterHadronicEnergy>
      <MinClusterElectromagneticEnergy> 0.f </MinClusterElectromagneticEnergy>
      <MinHitsInCluster> 15 </MinHitsInCluster>
      <AllowSingleLayerClusters> false </AllowSingleLayerClusters>
    </algorithm> 
    
    <!-- EVE Monitoring -->
    <algorithm type = "VisualMonitoring" description = "display all">
          
       <DisplayEvent>false</DisplayEvent>
       
       <ShowMCParticles>false</ShowMCParticles>
       <ShowCurrentCaloHits>true</ShowCurrentCaloHits>
       <ShowCurrentTracks>true</ShowCurrentTracks> 
       <ShowCurrentClusters>true</ShowCurrentClusters> 
       <ShowCurrentPfos>false</ShowCurrentPfos>
       <HitColors> iterate </HitColors>
       <ShowOnlyAvailable>false</ShowOnlyAvailable>
       
       <TransparencyThresholdE>-1.</TransparencyThresholdE>
       <EnergyScaleThresholdE>1.</EnergyScaleThresholdE> 
       <BlackBackground>true</BlackBackground>
       <ShowDetector>true</ShowDetector>
          
    </algorithm>
    
    
    
</pandora>
